<template>
  <div>
     <el-form ref="form" :model="form"    label-width="100px">
          <el-dialog title="发票申请" :visible.sync="modalShow" width="80%" :before-close="modalClose">

            <el-row :gutter="15">
              <el-col :span="24" style="margin-top: 0;">
                <el-divider content-position="center" ><el-link type="primary"><b>申请信息</b></el-link></el-divider>
              </el-col>
              <el-col :span="6">
                <el-form-item label="项目类型" prop="ApprovalType">
                  <el-select v-model="form.approvalType" placeholder="请选择项目类型" style="width: 100%;">
                    <el-option
                      v-for="dict in projectCategoryTypeList"
                      :key="dict.dictValue"
                      :label="dict.dictLabel"
                      :value="dict.dictValue"
                    />
                  </el-select>
                </el-form-item>
              </el-col>

              <el-col :span="8">

                <el-form-item label="项目编号" prop="proNo">
                  <el-input v-model="form.proNo" :readonly="true"  />
                </el-form-item>
               </el-col>
               <el-col :span="8">
                <el-form-item label="项目名称" prop="proName">
                  <el-input v-model="form.proName"  :readonly="true"     placeholder="请输入项目名称"  />
                </el-form-item>
              </el-col>



               <el-col :span="8">
                 <el-form-item label="事前审批表ID 关联事前审批表ID" prop="approvalId" v-if="show">
                    <el-input v-model="form.contractId" placeholder="" />
                 </el-form-item>
                <el-form-item label="合同编号"     prop="contractNo">
                    <el-input v-model="form.contractNo"  :readonly="true"  placeholder="请输入合同编号" />
                </el-form-item>
              </el-col>
              <el-col :span="8">
                <el-form-item label="合同名称"    prop="contractName">
                  <el-input v-model="form.contractName" :readonly="true"   placeholder="请输入合同名称" />
                </el-form-item>
              </el-col>
             <!-- <el-col :span="8">
                <el-form-item label="发票种类" prop="invoiceType" >
                 <el-select :style="{ width: '100%' }"
                   v-model="form.invoiceType"
                   placeholder="发票类型"
                 >
                   <el-option
                     v-for="dict in billTypeOptions"
                     :key="dict.dictValue"
                     :label="dict.dictLabel"
                     :value="dict.dictValue"
                   />
                 </el-select>
                </el-form-item>
               </el-col>
               <el-col :span="8"> -->
                <el-form-item label="部门编号" prop="reqDeptid">
                  <el-input v-model="form.reqDeptid"    :readonly="true"   placeholder="请输入申请部门编号" />
                </el-form-item>
              </el-col>
              <el-col :span="8">
                <el-form-item label="部门名称" prop="reqDeptname">
                  <el-input v-model="form.reqDeptname"   :readonly="true"    placeholder="请输入申请部门名称" />
                </el-form-item>
              </el-col>
                  <el-col :span="8">
                    <el-form-item  label="申请人编号" prop="reqUserid">
                      <el-input v-model="form.reqUserid"   :readonly="true"    placeholder="请输入申请人编号" />
                    </el-form-item>
                  </el-col>
                   <el-col :span="8">
                    <el-form-item label="申请人姓名" prop="reqUsername">
                      <el-input v-model="form.reqUsername"  :readonly="true"     placeholder="请输入申请人姓名" />
                    </el-form-item>
                  </el-col>
                  <el-col :span="8">
                    <el-form-item label="申请日期" prop="reqDate">
                      <el-date-picker clearable size="small" :readonly="true"  :style="{ width: '100%' }"
                        v-model="form.reqDate"
                        type="date"
                        value-format="yyyy-MM-dd"
                        placeholder="选择申请日期">
                      </el-date-picker>
                    </el-form-item>
                  </el-col>
                 <!-- <el-col :span="8">
                    <el-form-item label="单位名称" prop="payerName">
                      <selectCompany ref='company'   @ok='companyOk'/>
                    </el-form-item>
                  </el-col> -->
                  <!-- <el-col :span="8">
                    <el-form-item label="单位地址" prop="payerAddress">
                      <el-input v-model="form.payerAddress"      placeholder="请输入付款单位地址" />
                    </el-form-item>
                  </el-col>
                  <el-col :span="8">
                    <el-form-item label="纳税人识别号" prop="creditCode" >
                      <el-input v-model="form.creditCode" placeholder="请输入纳税人识别号" />
                    </el-form-item>
                  </el-col>
                  <el-col :span="8">
                    <el-form-item label="单位电话"    prop="payerPhone">
                      <el-input v-model="form.payerPhone"   placeholder="请输入付款单位电话" />
                    </el-form-item>
                  </el-col>
                  <el-col :span="8">
                    <el-form-item label="单位开户行"    prop="payerOpeningBank">
                      <el-input v-model="form.payerOpeningBank"   placeholder="请输入付款单位开户行" />
                    </el-form-item>
                  </el-col>
                  <el-col :span="8">
                    <el-form-item label="单位账号"    prop="payerAccount">
                      <el-input v-model="form.payerAccount"   placeholder="请输入付款单位账号" />
                    </el-form-item>
                  </el-col> -->
                  <el-col :span="8">
                    <el-form-item label="开票金额(含税)" prop="invoiceAmountTax">
                      <el-input v-model="form.invoiceAmountTax" :readonly="true"  placeholder="请输入开票金额"  @blur='takeAcc(this)' oninput="value=value.replace(/[^0-9.]/g,'')"/>
                    </el-form-item>
                  </el-col>
                  <el-col :span="8">
                    <el-form-item label="开票金额(不含税)"    prop="invoiceAmountNtax">
                      <el-input v-model="form.invoiceAmountNtax"  :readonly="true"  placeholder="请输入开票金额" />
                    </el-form-item>
                  </el-col>
                  <!-- <el-col :span="8">
                    <el-form-item label="预计回款时间" prop="expectedCollectionTime" >
                      <el-date-picker clearable size="small"
                        v-model="form.expectedCollectionTime"
                        type="date"  :style="{ width: '100%' }"
                        value-format="yyyy-MM-dd"
                        placeholder="选择预计回款时间">
                      </el-date-picker>
                    </el-form-item>
                  </el-col> -->
                </el-row>

            <!-- <el-col :span="24" style="margin-top: 0;">
             <el-divider content-position="center" ><el-link type="primary"><b>开票信息</b></el-link></el-divider>
            </el-col> -->
<el-row :gutter="15">

  <el-table :data="tableData">
    <el-table-column label="审批记录"    header-align="center" align="center">
    <el-table-column label="任务节点" prop="taskNodeName" header-align="center" align="center">
    </el-table-column>

    <el-table-column label="审批人" prop="createName" header-align="center" align="center">
    </el-table-column>
    <el-table-column label="审批意见" prop="controlValue" header-align="center" align="center">
    </el-table-column
    <el-table-column label="审批时间" prop="createTime"   header-align="center" align="center">
    </el-table-column
    </el-table-column>
  </el-table>


  </el-row>
    </el-dialog>
     </el-form>
  </div>

</template>

<script>
  import { findWorkFlowFormData ,listApplyCollection,detailNgcApproval,findContract,detailhtCon,getUserInfo  } from "@/api/collection/common";
    export default {
        name: "index",
        data() {
            return {
               tableData:[],

              show:false,
                modalShow:false,
                 projectCategoryTypeList:[],
                 form: {
                   proNo: null,
                    proName:null,
                    contractNo:null,
                    contractName:null,
                    reqUsername:null,
                    reqDeptname:null,
                    reqDate:null,
                    invoiceAmountTax:null,
                    invoiceAmountNtax:null,
                    businessKey:null
                  },
            }
        },
        methods:{
            init(row){
              this.form.businessKey = row.id;
              findWorkFlowFormData(this.addDateRange(this.form, this.dateRange)).then(response => {
                
                this.tableData = response;
              });


              //项目类型列表
              this.getDicts("project_category_type").then((response) => {
                this.projectCategoryTypeList = response.data;
              });
                this.modalShow = true
                this.$nextTick(() =>{
                    this.form.proNo = row.proNo;
                    this.form.proName = row.proName;
                    this.form.contractNo = row.contractNo;
                    this.form.contractName = row.contractName;
                    this.form.reqUsername = row.reqUsername;
                    this.form.reqDeptname = row.reqDeptname;
                    this.form.reqDate = row.reqDate;
                    this.form.invoiceAmountTax = row.invoiceAmountTax;
                    this.form.invoiceAmountNtax = row.invoiceAmountNtax;
                })
            },
            modalClose(){
                this.modalShow = false;
            }
        },
    }

</script>

<style scoped>

</style>
